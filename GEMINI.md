# Project Summary (Generated by Gemini CLI)

This document summarizes the current state and key changes made to the `hello_springboot` project.

## Project Overview
The project has been transformed into a Spring Boot application acting as a Certificate Authority (CA) server. It can issue and manage X.509 certificates, and also sign JSON Web Tokens (JWTs) using the generated certificates' private keys.

## Key Configurations and Features

*   **Spring Boot Version:** 3.5.3
*   **Java Version:** 22
*   **Main Package:** `org.license`
*   **Server Port:** 18080 (configured in `src/main/resources/application.properties`)
*   **Services:** `JwtSigningService` (formerly `JwtCertificateService`)
*   **Database Driver:** `org.xerial:sqlite-jdbc` (SQLite JDBC Driver)

### CA Functionality
*   **CA KeyStore:** `certs/ca.jks`
    *   Contains the CA certificate and private key.
    *   The application monitors this file for changes and reloads the CA automatically.
    *   **Note:** The `ca.jks` file must be manually generated using `keytool` as instructed during the setup.
*   **Generated Certificates KeyStore:** `certs/generated.jks`
    *   Stores all newly generated certificates and their corresponding private keys in JKS format.
    *   This KeyStore is created if it doesn't exist and is automatically saved upon certificate generation or deletion.

### Database Configuration
*   **Type:** SQLite
*   **File:** `test.db` (configured in `src/main/resources/application.properties`)
*   **JPA DDL Auto:** `update` (configured in `src/main/resources/application.properties`)

### REST API Endpoints

*   **GET `/hi`**: Returns "Hello World". (Initial test endpoint)
*   **GET `/certificates`**: (Handled by `JwtSigningController`) Lists all certificates currently stored in `certs/generated.jks`.
*   **POST `/certificates/generate`**: (Handled by `JwtSigningController`) Generates a new certificate and its private key, storing them in `certs/generated.jks`.
    *   **Parameters:**
        *   `commonName` (String, required): The common name for the new certificate.
        *   `validityDays` (long, optional, default: 365): The validity period in days.
*   **DELETE `/certificates/{commonName}`**: (Handled by `JwtSigningController`) Deletes a certificate and its private key from `certs/generated.jks` based on the provided `commonName`.
*   **POST `/certificates/sign-jwt`**: (Handled by `JwtSigningController`) Signs a set of JSON claims with the private key of a specified certificate and returns a complete JWS token. Upon execution, a record of the signing attempt (both successful and failed) is saved to the database and can be retrieved via the `/history` endpoint.
    *   **Request Body:****
        ```json
        {
          "commonName": "your-certificate-common-name",
          "claims": {
            "sub": "1234567890",
            "name": "John Doe",
            "iat": 1516239022
          }
        }
        ```
*   **GET `/certificates/ca-certificate/pem`**: (Handled by `JwtSigningController`) Returns the CA's public key certificate in X.509/PEM format.
*   **GET `/certificates/{commonName}/pem`**: (Handled by `JwtSigningController`) Returns a generated certificate in X.509/PEM format based on the provided `commonName`.

*   **GET `/history`**: (Handled by `JwtHistoryController`) Lists all JWT signing history records.
*   **POST `/history`**: (Handled by `JwtHistoryController`) Adds a new JWT signing history record.
    *   **Request Body:** `JwtSignHistory` object.
*   **DELETE `/history/{id}`**: (Handled by `JwtHistoryController`) Deletes a signing history record by its ID.

*   **POST `/schemas/{schemaName}`**: (Handled by `JwtSchemaController`) Stores a JSON schema definition for claims validation.
    *   **Parameters:**
        *   `schemaName` (String, required): The name to assign to the schema.
    *   **Request Body:** Raw JSON schema content.
*   **GET `/schemas`**: (Handled by `JwtSchemaController`) Lists all stored JSON schema names.
*   **GET `/schemas/{schemaName}`**: (Handled by `JwtSchemaController`) Retrieves a stored JSON schema definition.
    *   **Parameters:**
        *   `schemaName` (String, required): The name of the schema to retrieve.
*   **DELETE `/schemas/{schemaName}`**: (Handled by `JwtSchemaController`) Deletes a stored JSON schema definition.
    *   **Parameters:**
        *   `schemaName` (String, required): The name of the schema to delete.

## Utility Scripts

*   **`decode_jwt.py`**: A Python 3 script to decode a JWT string and display its header and payload in a readable JSON format.
    *   **Usage:** `python3 decode_jwt.py <jwt_string>`

## How to Run

1.  **Ensure `ca.jks` exists:** Make sure you have generated the `ca.jks` file in the `certs/` directory using the `keytool` command provided during the setup.
2.  **Build the project:**
    ```bash
    ./gradlew clean build
    ```
3.  **Run the application:**
    ```bash
    ./gradlew bootRun &
    ```
    (The `&` runs it in the background. You can check logs in `bootRun.log`.)

## Next Steps / Resuming Work

You can continue developing by modifying existing files or adding new features. Refer to the API endpoints above for current functionality.